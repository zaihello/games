<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜æ†¶é…å°éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-wrapper {
            width:100px;
            height:100px;
            position:relative;
            transform-style:preserve-3d;
            transition:transform 0.5s;
            cursor:pointer;
            border-radius:8px;
        }
        .card-wrapper.flipped {
            transform:rotateY(180deg);
        }
        .card-wrapper.matched {
            opacity:0.5;
            /* é…å°æˆåŠŸå¾Œï¼Œå¡ç‰‡æ°¸é ä¸èƒ½å†è¢«é»æ“Š */
            pointer-events:none;
        }
        .card-face {
            position:absolute;
            width: 100%;
            height:100%;
            backface-visibility:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            border-radius:8px;
            font-size:40px;
            font-weight:bold;
        }  
        /* å¡ç‰‡èƒŒé¢é¡è‰² */
        .back-face {
            background-color:deepskyblue;
            color:aliceblue;
        } 
        /* å¡ç‰‡æ­£é¢é¡è‰² */ 
        .front-face {
            background-color:chartreuse;
            transform:rotateY(180deg);
        }
    </style>
</head>
<body>
<div class="max-w-lg m-auto mt-10 bg-blue-500 p-6"> 
    <h1 class="text-center text-2xl font-bold">è¨˜æ†¶é…å°éŠæˆ²</h1>
    <div class="flex justify-between my-5">
        <div id="timerDisplay"></div>
        <button id="restartButton" class="border rounded ring-2 ring-white p-2 hover:bg-blue-800 hover:text-white transition duration-500 font-bold text-xl">é‡æ–°é–‹å§‹</button>   
    </div>
    <div class="flex justify-center">
        <div id="container"></div>
    </div>
    <div class="">
        <p id="message" class="text-red-500 text-lg font-bold text-center bg-white mt-6"></p> 
    </div>
</div>  

<script>
    const symbols = ['ğŸ', 'ğŸŒ', 'ğŸ¥', 'ğŸ‰', 'ğŸ‡', 'ğŸ', 'ğŸ“', 'ğŸ‹']
    const cardSymbols = symbols.flatMap(symbol => [symbol,symbol])
    const container = document.getElementById('container')
    container.classList.add("grid","grid-cols-4","gap-4")
   
    let shuffledSymbols = []//è½‰æ›æ ¼å¼å¾Œçš„éš¨æ©Ÿç‰Œ
    let isGameLocked = false//é–å®šæ‰€æœ‰å¡ç‰‡çš„é»æ“Šè¼¸å…¥ï¼Œåœ¨ç©å®¶ç¿»é–‹ç¬¬äºŒå¼µç‰Œå¾Œã€ç­‰å¾…çµæœçš„æœŸé–“ï¼Œé¿å…ç¿»åˆ°ç¬¬3å¼µç‰Œã€‚
    let firstCardIndex = null
    let secondCardIndex = null

    const TIMER_DURATION = 60 //ç§’(éŠæˆ²æ™‚é–“)
    let timeRemaining = TIMER_DURATION 
    let timerInterval; //ç”¨ä¾†å„²å­˜ setInterval çš„ ID,clearInterval()æœƒç”¨åˆ°ã€‚
    const timerDisplay = document.getElementById("timerDisplay")
    const messageElement = document.getElementById("message")



    //æ´—ç‰Œ
    function shuffleArray(array) {
        for ( let i = array.length - 1 ; i > 0 ; i--) {
            const j = Math.floor(Math.random() * ( i + 1 ) )
            // ä½¿ç”¨è§£æ§‹è³¦å€¼é›»è…¦å‡ºç¾éŒ¯èª¤
            // [array[i],array[j]] = [array[j],array[i]]
            //ä½¿ç”¨å‚³çµ±æ–¹å¼
            const temp = array[i]; 
            array[i] = array[j]; 
            array[j] = temp; 
        }
        return array
    }
    
    // éŠæˆ²ç‰Œçš„åˆå§‹ç‹€æ…‹
    function initializeGame() {
        //éš¨æ©Ÿç‰Œ <note>ä½¿ç”¨[...cardSymbols]å‰µå»ºä¸€å€‹ å…¨æ–°çš„é™£åˆ—å‰¯æœ¬ï¼Œç¶­æŒå…¬å¹³æ€§ 
        const tempShuffled = shuffleArray([...cardSymbols]) 
        //åŠ å…¥isFlippedã€isMatched
        shuffledSymbols = tempShuffled.map((symbol,index) => ({
            index:index,
            symbol:symbol,
            isFlipped:false,//æœªæ€ç‰Œ
            isMatched:false,//æœªé…å°
        }))
        //æ¸…é™¤èˆŠå¡ç‰‡
        container.innerHTML = ''
        //å¡ç‰‡ç‹€æ…‹é‡è¨­
        resetTurn()
        //æ¸²æŸ“å¡ç‰‡
        shuffledSymbols.forEach((cardData,index) => {
            const cardElement = createCardElement(cardData.symbol,index)
            container.appendChild(cardElement);

        })
    }

    function createCardElement(symbol,index) {
        const wrapper = document.createElement('div')
        wrapper.className = 'card-wrapper'
        wrapper.dataset.index = index

        // èƒŒé¢:?
        const backFace = document.createElement('div')
        backFace.className = 'card-face back-face'
        backFace.textContent = '?'

        //æ­£é¢:åœ–æ¡ˆ
        const frontFace = document.createElement('div')
        frontFace.className = 'card-face front-face' 
        frontFace.innerHTML = symbol;

        wrapper.appendChild(backFace)
        wrapper.appendChild(frontFace)

        return wrapper;

    }
    // èª°è¢«é»æ“Šç”¨index(è¨­è®Šæ•¸)ã€è¢«é»æ“Šçš„è³‡æ–™å…§å®¹ã€è¿½è¹¤å¡ç‰‡ç¿»ç‰Œæ²’ç¿»ç‰Œç‹€æ…‹(è¨­è®Šæ•¸)
    // ç¬¬1å¼µç‰Œå’Œç¬¬2å¼µç‰Œé…å°
    // å·²é…å°çš„ç‰Œä¸èƒ½é»æ“Š (è¨­è®Šæ•¸)ã€å·²ç¶“æ€é–‹çš„ç‰Œä¸èƒ½é»æ“Š (è¨­è®Šæ•¸)  é€€å‡ºå‡½å¼

    function handleCardClick(event) {
        const cardElement = event.target.closest(".card-wrapper") 
        // é»æ“Šåˆ°å®¹å™¨çš„é–“éš™containerçš„gap-4 æœƒæ˜¯nullï¼Œå°±é€€å‡º
        if(!cardElement){
            return;
        }
        const index = parseInt(cardElement.dataset.index)
        const cardData = shuffledSymbols[index]

        //æª¢æŸ¥
        if(isGameLocked || cardData.isFlipped || cardData.isMatched) {
            return
        }
        //æ›´æ–°DOMå’ŒJavaScriptæ•¸æ“š
        cardData.isFlipped = true
        cardElement.classList.add("flipped")

        //é»æ“Šé‚è¼¯
        if( firstCardIndex === null ){
            //é€™æ˜¯ç¬¬ä¸€å¼µç‰Œ
            firstCardIndex = index   
            startTimer()

        }else{
            //é€™æ˜¯ç¬¬äºŒå¼µç‰Œ
            secondCardIndex = index
            isGameLocked = true

            checkMatch()
        } 
    }
    //å–å¾—è³‡æ–™ / æ¯”è¼ƒè³‡æ–™ / åŸ·è¡ŒæˆåŠŸæˆ–å¤±æ•— / æ¸…ç†ç‹€æ…‹
    function checkMatch() {
        //å–å¾—æ•¸æ“šç‰©ä»¶
        const card1 = shuffledSymbols[firstCardIndex]
        const card2 = shuffledSymbols[secondCardIndex]
        //å–å¾—DOMå…ƒç´ 
        const card1Element = container.children[firstCardIndex]
        const card2Element = container.children[secondCardIndex]

        if (card1.symbol === card2.symbol) {
            setTimeout(() => {
                card1.isMatched = true
                card2.isMatched = true 

                card1Element.classList.add("matched")
                card2Element.classList.add("matched")

                //é‡ç½®ç‰Œè³‡æ–™
                resetTurn()
                checkAllMatchedAndEnd()
            },1000)
            
        } else {
            setTimeout(() => {
                //æ•¸æ“šæ›´æ–°
                card1.isFlipped = false
                card2.isFlipped = false
                //DOMæ›´æ–°
                card1Element.classList.remove("flipped")
                card2Element.classList.remove("flipped")

                //é‡ç½®ç‰Œè³‡æ–™
                resetTurn()
            },1000)
        }
      
    }
    //é‡ç½®ç‰Œè³‡æ–™
    function resetTurn() {
        firstCardIndex = null
        secondCardIndex = null
        isGameLocked = false
    }
    //æ•¸æ“šã€è¦–è¦ºã€çµ‚æ­¢æ¢ä»¶(æ¯ç§’ç™¼ç”Ÿçš„äº‹æƒ…) é‚„æ²’å¯«å®Œ
    function updateTimer() {
        timeRemaining --;

        if(timerDisplay) {
            timerDisplay.textContent = `å‰©é¤˜${timeRemaining}ç§’`;  
            timerDisplay.className = "border rounded border-2 border-white p-2 bg-blue-800 text-white font-bold text-xl"
        }
        //ç‰Œéƒ½é…å°å®Œæˆ ||
        if(timeRemaining <= 0 ) {
            isGameLocked = true
            clearInterval(timerInterval)
            messageElement.textContent = 'æŒ‘æˆ°å¤±æ•—'
            messageElement.classList.add("p-3")
        }
        
    }
    //å•Ÿå‹•è¨ˆæ™‚å™¨
    function startTimer() {
        //æœ‰IDå°±æ¸…é™¤(æ¸…é™¤èˆŠçš„è¨ˆæ™‚å™¨ )
        if( timerInterval ) {
            return
        }
        //é‡è¨­æ™‚é–“(åˆå§‹åŒ–)
        timeRemaining = TIMER_DURATION
        if(timerDisplay) {
           timerDisplay.textContent = `å‰©é¤˜${timeRemaining}ç§’`; 
           timerDisplay.className = "border rounded border-2 border-white p-2 bg-blue-800 text-white font-bold text-xl"   
        }
        // å‰µå»ºä¸€å€‹è¨ˆæ™‚å™¨
        timerInterval = setInterval(updateTimer,1000)

    }
    //æª¢æŸ¥æ‰€æœ‰é…å°ä¸¦åŸ·è¡Œå‹åˆ©å‡½å¼
    function checkAllMatchedAndEnd() {
        const allMatched = shuffledSymbols.every(card => card.isMatched ) 

        if(allMatched) {
            //åŸ·è¡Œå‹åˆ©å‡½å¼
            handleWin()
            return true
        }
        return false

    }
    //å‹åˆ©å¾Œçš„æ“ä½œ
    function handleWin() {
        //åœæ­¢è¨ˆæ™‚å™¨
        stopTimer()

        if(messageElement) {
            messageElement.textContent = 'æŒ‘æˆ°æˆåŠŸ'
            messageElement.classList.add("p-3")
        }
        isGameLocked = true
    }
    //éŠæˆ²æˆåŠŸæ™‚é–“æš«åœ
    function stopTimer() {
        if(timerInterval) {
            //å–æ¶ˆé‡è¤‡ä»»å‹™ï¼Œæ™‚é–“æœƒæš«åœ
            clearInterval(timerInterval)
        }
    }
    //é‡æ–°é–‹å§‹
    function resetGame() {
        stopTimer()
        timerInterval = null // ç¢ºä¿è¨ˆæ™‚å™¨ ID è¢«æ¸…é™¤ï¼Œè®“ startTimer å¯ä»¥å†æ¬¡å•Ÿå‹•
        
        if(timerDisplay) {
            timeRemaining = TIMER_DURATION; 
            timerDisplay.textContent = `å‰©é¤˜${timeRemaining}ç§’`;
            timerDisplay.className = "border rounded border-2 border-white p-2 bg-blue-800 text-white font-bold text-xl" 
        }

        if(messageElement) {
            messageElement.textContent = ''
            messageElement.classList.remove("p-3")
        }
        
        initializeGame()
    } 


    //åœ¨å®¹å™¨ä¸Šç¶å®šé»æ“Šäº‹ä»¶
    container.addEventListener("click",handleCardClick)
    //ç¶å®šé‡æ–°é–‹å§‹æŒ‰éˆ•
    document.getElementById('restartButton').addEventListener("click",resetGame)
    //éŠæˆ²ç‰Œçš„åˆå§‹ç‹€æ…‹
    initializeGame()

</script>
</body>
</html>